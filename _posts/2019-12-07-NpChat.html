---
title: NpChat
date: 2019-12-07
layout: post
medium: https://ritikk.medium.com/npchat-604663a7047d
---
<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>NpChat</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">NpChat</h1>
</header>
<section data-field="subtitle" class="p-summary">
A Multimedia Sharing Application over Named Data Network
</section>
<section data-field="body" class="e-content">
<section name="6761" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8c53" id="8c53" class="graf graf--h3 graf--leading graf--title">NpChat, a Multimedia Sharing Application over NDN</h3><p name="5043" id="5043" class="graf graf--p graf-after--h3">reference <a href="http://dl.acm.org/citation.cfm?doid=3357150.3357402" data-href="http://dl.acm.org/citation.cfm?doid=3357150.3357402" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">http://dl.acm.org/citation.cfm?doid=3357150.3357402</a></p><figure name="e214" id="e214" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><img class="graf-image" data-image-id="1*3eqaaYNrVBHPO3XG-uW1HQ.png" data-width="512" data-height="512" data-is-featured="true" alt="NpChat logo" src="https://cdn-images-1.medium.com/max/600/1*3eqaaYNrVBHPO3XG-uW1HQ.png"><figcaption class="imageCaption">an NDN based multimedia sharing app</figcaption></figure><h3 name="0de0" id="0de0" class="graf graf--h3 graf-after--figure">In the world dominated by big internet players like Google, Facebook, etc., most of our day to day internet traffic is routed to their servers. Virtually everything from E-commerce, Social Media, Web Streaming are increasingly controlled by some giant corporation. This centralisation leads to much of our valuable user data being stored and regulated by the rules they decide and most of us agree to without caring to read the terms of their service. They may distribute or leak it to other third party companies just like what happened in the case of Facebook-Cambridge Analytica.</h3><p name="fd20" id="fd20" class="graf graf--p graf-after--h3">Such a connected world requires a decentralised end-to-end encrypted social multimedia app. And when looking on it from Information-centric network perspective, NpChat seems quite promising.</p><p name="18d9" id="18d9" class="graf graf--p graf-after--p">NpChat (from <a href="https://en.wikipedia.org/wiki/Named_data_networking" data-href="https://en.wikipedia.org/wiki/Named_data_networking" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">NDN</a>+ Snapchat) is an Android application that allows users to capture and share multimedia with friends in a secure and fully decentralised way, while still giving users complete control over their data. It is based on Named Data Network, a proposed evolution of the IP architecture that uses data-names(identifiers) as a kind of address and not just IP addresses. NDN aims to change the network fundamentally from end to end communication to content-based, wherein, not only IP address but also the data identifier and only the identifier can also be used to exchange information. More on <a href="https://named-data.net/project/archoverview/" data-href="https://named-data.net/project/archoverview/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">NDN</a></p><!--break--><h3 name="fd78" id="fd78" class="graf graf--h3 graf-after--p">NpChat</h3><p name="5033" id="5033" class="graf graf--p graf-after--h3">As NpChat is based on NDN, many of its concepts are blended into the app. As such, it may require further clarification of the idea.</p><p name="6a74" id="6a74" class="graf graf--p graf-after--p">As the Network layer is different in NDN and IP, it requires specially designed libraries and technologies to work with. NDN has a lot of support <a href="https://github.com/named-data" data-href="https://github.com/named-data" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">libraries</a> written in different languages actively developed to support application development. As NpChat is developed for Android, it uses java library <a href="https://github.com/named-data/jndn" data-href="https://github.com/named-data/jndn" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">jNDN</a> and some C++ libraries via the native interface. To connect to an NDN network, it uses <a href="https://play.google.com/store/apps/details?id=net.named_data.nfd" data-href="https://play.google.com/store/apps/details?id=net.named_data.nfd" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">NFD</a> (an android app to use NDN over IP network). This daemon is required for NpChat to work and send/receive messages.</p><p name="7e5d" id="7e5d" class="graf graf--p graf-after--p">Let’s get into the working of the app</p><h4 name="4e54" id="4e54" class="graf graf--h4 graf-after--p">Initialising</h4><p name="1f84" id="1f84" class="graf graf--p graf-after--h4">The app on it’s initialising does the following stuff:</p><ul class="postList"><li name="37cc" id="37cc" class="graf graf--li graf-after--p">Ensure NFD is installed and running in the background</li><li name="c9dd" id="c9dd" class="graf graf--li graf-after--li">Initialize Psync library using JNI and native code. More on Psync (partial state synchronisation protocol for NDN can be found <a href="https://named-data.net/wp-content/uploads/2017/05/scalable_name-based_data_synchronization.pdf" data-href="https://named-data.net/wp-content/uploads/2017/05/scalable_name-based_data_synchronization.pdf" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">here</a>.</li><li name="1523" id="1523" class="graf graf--li graf-after--li">Initialise the Psync partial producer. Register syncPrefix in NFD and sets internal filters for “sync” and “hello” under Prefix. Also, provide the prefixes available to synchronise</li><li name="71ed" id="71ed" class="graf graf--li graf-after--li">Initialise consumer manager and add consumer for each friend. Send a hello interest according to the Psync protocol and wait for the hello reply to synchronise further.</li><li name="e885" id="e885" class="graf graf--li graf-after--li">Make a new NDN Face</li><li name="b67c" id="b67c" class="graf graf--li graf-after--li">Make new <strong class="markup--strong markup--li-strong">AndroidSqlite3Pib</strong><em class="markup--em markup--li-em"> </em>object to help with SQLite for using <a href="https://named-data.net/doc/ndn-ccl-api/security/pib.html" data-href="https://named-data.net/doc/ndn-ccl-api/security/pib.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">PIB</a> NDN to store public keys</li><li name="f26b" id="f26b" class="graf graf--li graf-after--li">Make new <strong class="markup--strong markup--li-strong">TpmBackEndFile</strong><em class="markup--em markup--li-em"> </em>object to store and access private keys and provide its location to<em class="markup--em markup--li-em"> </em>AndroidSqlite3Pib<em class="markup--em markup--li-em"> </em>object</li><li name="c984" id="c984" class="graf graf--li graf-after--li">Make a new <strong class="markup--strong markup--li-strong">KeyChain </strong>object to help provide a set of interfaces to the security library</li><li name="be6b" id="be6b" class="graf graf--li graf-after--li">Fetch/generate the pub key for the user namespace in the app using the keychain object and store the PIB key and related identity and certificates.</li><li name="7397" id="7397" class="graf graf--li graf-after--li">Set the signing information for the face using the keychain and the generated certificate for the name</li><li name="da82" id="da82" class="graf graf--li graf-after--li">Set up the custom <strong class="markup--strong markup--li-strong">memory cache </strong>object to help serve data to interests after it’s not in the cache (like after app restart).</li><li name="7001" id="7001" class="graf graf--li graf-after--li">Register names to NFD for receiving and responding to incoming interests for data. Interests may be of data, file, cert, friends, network-discovery, discover, etc. While others are for the general exchange of data and certificates, network-discovery is used to find out other instances of NpChat and publish our namespace address to them.</li><li name="d3a6" id="d3a6" class="graf graf--li graf-after--li">Start network discovery using NFD multicast discovery, NSD (DNS-SD), and send network-discovery get and establish named routes to other users.</li><li name="4304" id="4304" class="graf graf--li graf-after--li">Call <strong class="markup--strong markup--li-strong">processEvents </strong>on a separate network thread and loop it continuously.</li></ul><p name="bb1a" id="bb1a" class="graf graf--p graf-after--li">With these things set up, the user can now interact with the app and send and receive media. But before doing that, he has to make friends.</p><h4 name="d299" id="d299" class="graf graf--h4 graf-after--p">Friends</h4><p name="354c" id="354c" class="graf graf--p graf-after--h4">Akin to the real world, making friends on NpChat also requires trust among the two parties. Trust in this context is the acceptance and verification of the signed data from the other party. This means that we accept the public key to be of that particular user. The acceptance of this public key involves various trust models as proposed and implemented in the app.</p><p name="bd6c" id="bd6c" class="graf graf--p graf-after--p">During the process of making friends (or building trust), they exchange their public keys. Once two users accept their friendship, they issue certificates to each other by signing the new friend’s key. The certificate is designed to certify the user to own a namespace (in this case, for the app).</p><p name="af52" id="af52" class="graf graf--p graf-after--p">So the main problem in a non-centralised app like this is to get suggested potential friends-list so that we can add new friends. Without a central list of available users, this is a rather challenging job. So, to discover and trust new users to be a new friend, the app uses:</p><ol class="postList"><li name="2676" id="2676" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Physical</strong> certificate exchange through QR exchange</li><li name="7e27" id="7e27" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Mutual Friend</strong>’s friend list: User can share his list of trusted friends with their friends so a user can have a list of potential friends</li><li name="8013" id="8013" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Domain: </strong>A user can easily trust and find other users from the same organisation, part of their namespace</li></ol><h4 name="e464" id="e464" class="graf graf--h4 graf-after--li">Media Sharing</h4><p name="5024" id="5024" class="graf graf--p graf-after--h4">Taking another look in the feed based sharing, it is evident that a user subscribes to friends feed. Once a friend publishes a piece of information, it is published to all his friend (who has subscribed to his feed). NpChat uses partial sync mode in PSync to realise this pub-sub functionality. Psync is designed to inform the consumers of a new piece of data produced. The friend can then request the producer (in the form of interest) to get that data back. Also, while logging into the app, a user can sync his state with that of the producer. This will get the latest data from him.</p><h4 name="1a20" id="1a20" class="graf graf--h4 graf-after--p">Access Control</h4><p name="fbbc" id="fbbc" class="graf graf--p graf-after--h4">A user in NpChat may share a piece of data with a particular user or a group of user he wants to. Unless we encrypt the data, every user on NDN can access it, given he knows its unique name. This possesses a significant challenge to privacy. So to allow only a certain number of people to access a particular data, NpChat uses both Asymmetric and Symmetric key encryption.</p><p name="e12e" id="e12e" class="graf graf--p graf-after--p">As mentioned above, NpChat user stores the public keys of his friend upon adding him as a friend. The data to be sent is encrypted using a symmetric key (content key). To send the data, NpChat sends SyncData (metadata) to all the friend through Psync. This SyncData is itself encrypted by the selected friend’s public key. Upon receiving this information, each recipient in the set of authorised friends fetches both the filename and the encrypted content key, decrypts the content key and then decrypts the data using the content key. Even if an unauthorised friend retrieves the encrypted data, he/she will not be able to decrypt the content key and thus cannot decrypt the data.</p><blockquote name="e8e3" id="e8e3" class="graf graf--pullquote graf-after--p">For more and detailed description of the app, head over to the reference paper and the code repository.</blockquote><h3 name="8890" id="8890" class="graf graf--h3 graf-after--pullquote">Way Ahead</h3><p name="105f" id="105f" class="graf graf--p graf-after--h3">As of now, NFD is available on the play store, and NpChat is almost ready to be released. The source code of the app is available under GNU GPL v3.0 <a href="https://github.com/named-data-mobile/ndn-photo-app" data-href="https://github.com/named-data-mobile/ndn-photo-app" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>. The primary work is done, and the app can be used to share data in a local network. Some of the considerable work left, for the app to be done effectively are:</p><ul class="postList"><li name="f1b9" id="f1b9" class="graf graf--li graf-after--p">Improving the user interface</li><li name="2484" id="2484" class="graf graf--li graf-after--li">Connecting with the NDN Testbed</li><li name="b980" id="b980" class="graf graf--li graf-after--li">Managing Groups</li><li name="14a8" id="14a8" class="graf graf--li graf-after--li">Enhancing user discovery</li><li name="363f" id="363f" class="graf graf--li graf-after--li">Handling edge cases</li></ul><p name="d272" id="d272" class="graf graf--p graf-after--li graf--trailing">among others. More information on this can be found <a href="https://redmine.named-data.net/projects/npchat/issues" data-href="https://redmine.named-data.net/projects/npchat/issues" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@ritikk" class="p-author h-card">Ritik kumar</a> on <a href="https://medium.com/p/604663a7047d"><time class="dt-published" datetime="2019-12-07T20:11:24.405Z">December 7, 2019</time></a>.</p><p><a href="https://medium.com/@ritikk/npchat-604663a7047d" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 20, 2020.</p></footer></article></body></html>
